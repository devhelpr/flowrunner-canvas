/*
 * ATTENTION: The "eval" devtool has been used (maybe by default in mode: "development").
 * This devtool is neither made for production nor for readable output files.
 * It uses "eval()" calls to create a separate source file in the browser devtools.
 * If you are trying to read the output file, select a different devtool (https://webpack.js.org/configuration/devtool/)
 * or disable the default devtool with "devtool: false".
 * If you are looking for production-ready output files, see mode: "production" (https://webpack.js.org/configuration/mode/).
 */
(self["flowcanvaswebpackJsonpPlugin"] = self["flowcanvaswebpackJsonpPlugin"] || []).push([["packages_flowrunner-canvas-core_lib_html-plugins_form-controls_richtexteditor_js"],{

/***/ "../../packages/flowrunner-canvas-core/lib/html-plugins/form-controls/richtexteditor.js":
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"RichTextEditor\": () => (/* binding */ RichTextEditor)\n/* harmony export */ });\n/* harmony import */ var react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(\"../../node_modules/react/jsx-runtime.js\");\n/* harmony import */ var react__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(\"../../node_modules/react/index.js\");\n/* harmony import */ var react__WEBPACK_IMPORTED_MODULE_1___default = /*#__PURE__*/__webpack_require__.n(react__WEBPACK_IMPORTED_MODULE_1__);\n/* harmony import */ var _use_form_control__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(\"../../packages/flowrunner-canvas-core/lib/html-plugins/form-controls/use-form-control.js\");\n/* harmony import */ var draft_js__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(\"../../node_modules/draft-js/lib/Draft.js\");\n/* harmony import */ var draft_js__WEBPACK_IMPORTED_MODULE_3___default = /*#__PURE__*/__webpack_require__.n(draft_js__WEBPACK_IMPORTED_MODULE_3__);\n/* harmony import */ var react_draft_wysiwyg__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(\"../../node_modules/react-draft-wysiwyg/dist/react-draft-wysiwyg.js\");\n/* harmony import */ var react_draft_wysiwyg__WEBPACK_IMPORTED_MODULE_4___default = /*#__PURE__*/__webpack_require__.n(react_draft_wysiwyg__WEBPACK_IMPORTED_MODULE_4__);\n/* harmony import */ var draft_convert__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(\"../../node_modules/draft-convert/esm/index.js\");\n/* harmony import */ var draftjs_to_html__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(\"../../node_modules/draftjs-to-html/lib/draftjs-to-html.js\");\n/* harmony import */ var draftjs_to_html__WEBPACK_IMPORTED_MODULE_6___default = /*#__PURE__*/__webpack_require__.n(draftjs_to_html__WEBPACK_IMPORTED_MODULE_6__);\n/* harmony import */ var html_to_draftjs__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(\"../../node_modules/html-to-draftjs/dist/html-to-draftjs.js\");\n/* harmony import */ var html_to_draftjs__WEBPACK_IMPORTED_MODULE_7___default = /*#__PURE__*/__webpack_require__.n(html_to_draftjs__WEBPACK_IMPORTED_MODULE_7__);\n/* harmony import */ var dompurify__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(\"../../node_modules/dompurify/dist/purify.js\");\n/* harmony import */ var dompurify__WEBPACK_IMPORTED_MODULE_8___default = /*#__PURE__*/__webpack_require__.n(dompurify__WEBPACK_IMPORTED_MODULE_8__);\n/* harmony import */ var _helpers_focus__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(\"../../packages/flowrunner-canvas-core/lib/html-plugins/form-controls/helpers/focus.js\");\n\n\n\n\n\n\n\n\n\n\n\nconst RichTextEditor = (props) => {\n    const { metaInfo, node } = props;\n    const [editorState, setEditorState] = (0,react__WEBPACK_IMPORTED_MODULE_1__.useState)(() => {\n        const contentBlock = html_to_draftjs__WEBPACK_IMPORTED_MODULE_7___default()(props.value || \"\");\n        if (contentBlock) {\n            const contentState = draft_js__WEBPACK_IMPORTED_MODULE_3__.ContentState.createFromBlockArray(contentBlock.contentBlocks);\n            const editorState = draft_js__WEBPACK_IMPORTED_MODULE_3__.EditorState.createWithContent(contentState);\n            return editorState;\n        }\n        else {\n            return draft_js__WEBPACK_IMPORTED_MODULE_3__.EditorState.createEmpty();\n        }\n    });\n    let formControl = (0,_use_form_control__WEBPACK_IMPORTED_MODULE_2__.useFormControlFromCode)(props.value, metaInfo, props.onChange);\n    (0,react__WEBPACK_IMPORTED_MODULE_1__.useEffect)(() => {\n        const result = convertContentToHTML();\n        formControl.handleChangeByValue(result);\n    }, [editorState]);\n    (0,react__WEBPACK_IMPORTED_MODULE_1__.useEffect)(() => {\n        try {\n            let currentHtml = (0,draft_convert__WEBPACK_IMPORTED_MODULE_5__.convertToHTML)(editorState.getCurrentContent());\n            if (currentHtml.trim() == props.value.trim()) {\n                return;\n            }\n            const contentBlock = html_to_draftjs__WEBPACK_IMPORTED_MODULE_7___default()(props.value);\n            if (contentBlock) {\n                const contentState = draft_js__WEBPACK_IMPORTED_MODULE_3__.ContentState.createFromBlockArray(contentBlock.contentBlocks);\n                const newEditorState = draft_js__WEBPACK_IMPORTED_MODULE_3__.EditorState.createWithContent(contentState);\n                const currentSelection = editorState.getSelection();\n                const stateWithContentAndSelection = draft_js__WEBPACK_IMPORTED_MODULE_3__.EditorState.forceSelection(editorState, currentSelection);\n                setEditorState(stateWithContentAndSelection);\n            }\n        }\n        catch (err) {\n            console.log(`Error in Richtexteditor useEffect ${err}`);\n        }\n    }, [props.value]);\n    const handleEditorChange = (state) => {\n        setEditorState(state);\n    };\n    const convertContentToHTML = () => {\n        return draftjs_to_html__WEBPACK_IMPORTED_MODULE_6___default()((0,draft_js__WEBPACK_IMPORTED_MODULE_3__.convertToRaw)(editorState.getCurrentContent()));\n    };\n    const createMarkup = (html) => {\n        return {\n            __html: dompurify__WEBPACK_IMPORTED_MODULE_8___default().sanitize(html)\n        };\n    };\n    const insertImage = (url) => {\n        console.log(`insertImage ${url}`);\n        const contentState = editorState.getCurrentContent();\n        const contentStateWithEntity = contentState.createEntity(\"IMAGE\", \"IMMUTABLE\", { src: `/media/${url.name}` });\n        const entityKey = contentStateWithEntity.getLastCreatedEntityKey();\n        const newEditorState = draft_js__WEBPACK_IMPORTED_MODULE_3__.EditorState.set(editorState, { currentContent: contentStateWithEntity });\n        return draft_js__WEBPACK_IMPORTED_MODULE_3__.AtomicBlockUtils.insertAtomicBlock(newEditorState, entityKey, \" \");\n    };\n    const uploadImageCallBack = (file) => {\n        return new Promise((resolve, reject) => {\n            console.log(\"uploadImageCallBack\", file);\n            const xhr = new XMLHttpRequest();\n            xhr.open('POST', '/api/media');\n            const data = new FormData();\n            data.append('image', file);\n            xhr.send(data);\n            xhr.addEventListener('load', () => {\n                console.log(\"uploadImageCallBack load\", xhr.responseText);\n                const response = JSON.parse(xhr.responseText);\n                resolve({\n                    data: {\n                        link: `/media/${response.data.name}`\n                    }\n                });\n            });\n            xhr.addEventListener('error', () => {\n                console.log(\"uploadImageCallBack error\", xhr.responseText);\n                const error = JSON.parse(xhr.responseText);\n                reject(error);\n            });\n        });\n    };\n    return (0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsxs)(\"div\", { className: \"form-group\", children: [(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsxs)(\"label\", { children: [(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)(\"strong\", { children: metaInfo.label || metaInfo.fieldName || node.name }), !!metaInfo.required && \" *\"] }), (0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)(react_draft_wysiwyg__WEBPACK_IMPORTED_MODULE_4__.Editor, { name: metaInfo.fieldName, editorState: editorState, onEditorStateChange: handleEditorChange, wrapperClassName: \"wrapper-class\", editorClassName: \"editor-class\", toolbarClassName: \"toolbar-class\", onFocus: _helpers_focus__WEBPACK_IMPORTED_MODULE_9__.onFocus, readOnly: !props.enabled, toolbar: {\n                    inline: { inDropdown: true },\n                    image: {\n                        uploadCallback: uploadImageCallBack,\n                        alt: {\n                            present: true,\n                            mandatory: false\n                        }\n                    }\n                } }), !!metaInfo.hasPreview && (0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)(\"div\", { className: \"preview\", dangerouslySetInnerHTML: createMarkup(draftjs_to_html__WEBPACK_IMPORTED_MODULE_6___default()((0,draft_js__WEBPACK_IMPORTED_MODULE_3__.convertToRaw)(editorState.getCurrentContent()))) })] });\n};\n//# sourceMappingURL=richtexteditor.js.map\n\n//# sourceURL=webpack://code-flow-canvas/../../packages/flowrunner-canvas-core/lib/html-plugins/form-controls/richtexteditor.js?");

/***/ })

}]);