/*
 * ATTENTION: The "eval" devtool has been used (maybe by default in mode: "development").
 * This devtool is neither made for production nor for readable output files.
 * It uses "eval()" calls to create a separate source file in the browser devtools.
 * If you are trying to read the output file, select a different devtool (https://webpack.js.org/configuration/devtool/)
 * or disable the default devtool with "devtool: false".
 * If you are looking for production-ready output files, see mode: "production" (https://webpack.js.org/configuration/mode/).
 */
(self["flowcanvaswebpackJsonpPlugin"] = self["flowcanvaswebpackJsonpPlugin"] || []).push([["src_components_html-plugins_form-controls_richtexteditor_tsx"],{

/***/ "./src/components/html-plugins/form-controls/richtexteditor.tsx":
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"RichTextEditor\": () => (/* binding */ RichTextEditor)\n/* harmony export */ });\n/* harmony import */ var react__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(\"./node_modules/react/index.js\");\n/* harmony import */ var _use_form_control__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(\"./src/components/html-plugins/form-controls/use-form-control.ts\");\n/* harmony import */ var draft_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(\"./node_modules/draft-js/lib/Draft.js\");\n/* harmony import */ var draft_js__WEBPACK_IMPORTED_MODULE_2___default = /*#__PURE__*/__webpack_require__.n(draft_js__WEBPACK_IMPORTED_MODULE_2__);\n/* harmony import */ var react_draft_wysiwyg__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(\"./node_modules/react-draft-wysiwyg/dist/react-draft-wysiwyg.js\");\n/* harmony import */ var react_draft_wysiwyg__WEBPACK_IMPORTED_MODULE_3___default = /*#__PURE__*/__webpack_require__.n(react_draft_wysiwyg__WEBPACK_IMPORTED_MODULE_3__);\n/* harmony import */ var draft_convert__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(\"./node_modules/draft-convert/esm/index.js\");\n/* harmony import */ var draftjs_to_html__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(\"./node_modules/draftjs-to-html/lib/draftjs-to-html.js\");\n/* harmony import */ var draftjs_to_html__WEBPACK_IMPORTED_MODULE_5___default = /*#__PURE__*/__webpack_require__.n(draftjs_to_html__WEBPACK_IMPORTED_MODULE_5__);\n/* harmony import */ var html_to_draftjs__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(\"./node_modules/html-to-draftjs/dist/html-to-draftjs.js\");\n/* harmony import */ var html_to_draftjs__WEBPACK_IMPORTED_MODULE_6___default = /*#__PURE__*/__webpack_require__.n(html_to_draftjs__WEBPACK_IMPORTED_MODULE_6__);\n/* harmony import */ var dompurify__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(\"./node_modules/dompurify/dist/purify.js\");\n/* harmony import */ var dompurify__WEBPACK_IMPORTED_MODULE_7___default = /*#__PURE__*/__webpack_require__.n(dompurify__WEBPACK_IMPORTED_MODULE_7__);\n/* harmony import */ var _helpers_focus__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(\"./src/components/html-plugins/form-controls/helpers/focus.ts\");\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\nconst RichTextEditor = (props) => {\r\n    const { metaInfo, node } = props;\r\n    const [editorState, setEditorState] = (0,react__WEBPACK_IMPORTED_MODULE_0__.useState)(() => {\r\n        const contentBlock = html_to_draftjs__WEBPACK_IMPORTED_MODULE_6___default()(props.value || \"\");\r\n        if (contentBlock) {\r\n            const contentState = draft_js__WEBPACK_IMPORTED_MODULE_2__.ContentState.createFromBlockArray(contentBlock.contentBlocks);\r\n            const editorState = draft_js__WEBPACK_IMPORTED_MODULE_2__.EditorState.createWithContent(contentState);\r\n            return editorState;\r\n        }\r\n        else {\r\n            return draft_js__WEBPACK_IMPORTED_MODULE_2__.EditorState.createEmpty();\r\n        }\r\n    });\r\n    let formControl = (0,_use_form_control__WEBPACK_IMPORTED_MODULE_1__.useFormControlFromCode)(props.value, metaInfo, props.onChange);\r\n    (0,react__WEBPACK_IMPORTED_MODULE_0__.useEffect)(() => {\r\n        const result = convertContentToHTML();\r\n        formControl.handleChangeByValue(result);\r\n    }, [editorState]);\r\n    (0,react__WEBPACK_IMPORTED_MODULE_0__.useEffect)(() => {\r\n        try {\r\n            let currentHtml = (0,draft_convert__WEBPACK_IMPORTED_MODULE_4__.convertToHTML)(editorState.getCurrentContent());\r\n            if (currentHtml.trim() == props.value.trim()) {\r\n                return;\r\n            }\r\n            const contentBlock = html_to_draftjs__WEBPACK_IMPORTED_MODULE_6___default()(props.value);\r\n            if (contentBlock) {\r\n                const contentState = draft_js__WEBPACK_IMPORTED_MODULE_2__.ContentState.createFromBlockArray(contentBlock.contentBlocks);\r\n                const newEditorState = draft_js__WEBPACK_IMPORTED_MODULE_2__.EditorState.createWithContent(contentState);\r\n                const currentSelection = editorState.getSelection();\r\n                const stateWithContentAndSelection = draft_js__WEBPACK_IMPORTED_MODULE_2__.EditorState.forceSelection(editorState, currentSelection);\r\n                setEditorState(stateWithContentAndSelection);\r\n            }\r\n        }\r\n        catch (err) {\r\n            console.log(`Error in Richtexteditor useEffect ${err}`);\r\n        }\r\n    }, [props.value]);\r\n    const handleEditorChange = (state) => {\r\n        setEditorState(state);\r\n    };\r\n    const convertContentToHTML = () => {\r\n        return draftjs_to_html__WEBPACK_IMPORTED_MODULE_5___default()((0,draft_js__WEBPACK_IMPORTED_MODULE_2__.convertToRaw)(editorState.getCurrentContent()));\r\n    };\r\n    const createMarkup = (html) => {\r\n        return {\r\n            __html: dompurify__WEBPACK_IMPORTED_MODULE_7___default().sanitize(html)\r\n        };\r\n    };\r\n    const insertImage = (url) => {\r\n        console.log(`insertImage ${url}`);\r\n        const contentState = editorState.getCurrentContent();\r\n        const contentStateWithEntity = contentState.createEntity(\"IMAGE\", \"IMMUTABLE\", { src: `/media/${url.name}` });\r\n        const entityKey = contentStateWithEntity.getLastCreatedEntityKey();\r\n        const newEditorState = draft_js__WEBPACK_IMPORTED_MODULE_2__.EditorState.set(editorState, { currentContent: contentStateWithEntity });\r\n        return draft_js__WEBPACK_IMPORTED_MODULE_2__.AtomicBlockUtils.insertAtomicBlock(newEditorState, entityKey, \" \");\r\n    };\r\n    const uploadImageCallBack = (file) => {\r\n        return new Promise((resolve, reject) => {\r\n            console.log(\"uploadImageCallBack\", file);\r\n            const xhr = new XMLHttpRequest();\r\n            xhr.open('POST', '/api/media');\r\n            const data = new FormData();\r\n            data.append('image', file);\r\n            xhr.send(data);\r\n            xhr.addEventListener('load', () => {\r\n                console.log(\"uploadImageCallBack load\", xhr.responseText);\r\n                const response = JSON.parse(xhr.responseText);\r\n                resolve({\r\n                    data: {\r\n                        link: `/media/${response.data.name}`\r\n                    }\r\n                });\r\n            });\r\n            xhr.addEventListener('error', () => {\r\n                console.log(\"uploadImageCallBack error\", xhr.responseText);\r\n                const error = JSON.parse(xhr.responseText);\r\n                reject(error);\r\n            });\r\n        });\r\n    };\r\n    return react__WEBPACK_IMPORTED_MODULE_0__.createElement(\"div\", { className: \"form-group\" },\r\n        react__WEBPACK_IMPORTED_MODULE_0__.createElement(\"label\", null,\r\n            react__WEBPACK_IMPORTED_MODULE_0__.createElement(\"strong\", null, metaInfo.label || metaInfo.fieldName || node.name),\r\n            !!metaInfo.required && \" *\"),\r\n        react__WEBPACK_IMPORTED_MODULE_0__.createElement(react_draft_wysiwyg__WEBPACK_IMPORTED_MODULE_3__.Editor, { name: metaInfo.fieldName, editorState: editorState, onEditorStateChange: handleEditorChange, wrapperClassName: \"wrapper-class\", editorClassName: \"editor-class\", toolbarClassName: \"toolbar-class\", onFocus: _helpers_focus__WEBPACK_IMPORTED_MODULE_8__.onFocus, readOnly: !props.enabled, toolbar: {\r\n                inline: { inDropdown: true },\r\n                image: {\r\n                    uploadCallback: uploadImageCallBack,\r\n                    alt: {\r\n                        present: true,\r\n                        mandatory: false\r\n                    }\r\n                }\r\n            } }),\r\n        !!metaInfo.hasPreview && react__WEBPACK_IMPORTED_MODULE_0__.createElement(\"div\", { className: \"preview\", dangerouslySetInnerHTML: createMarkup(draftjs_to_html__WEBPACK_IMPORTED_MODULE_5___default()((0,draft_js__WEBPACK_IMPORTED_MODULE_2__.convertToRaw)(editorState.getCurrentContent()))) }));\r\n};\r\n\n\n//# sourceURL=webpack://@devhelpr/flowrunner-canvas/./src/components/html-plugins/form-controls/richtexteditor.tsx?");

/***/ })

}]);